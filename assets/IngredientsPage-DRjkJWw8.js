import{c as q,r as n,i as K,E as Q,u as _,k as D,j as e,B as I,X as ee,Y as se}from"./index-C0Eqig3U.js";import{C as z,a as B,c as U,e as Y,b as te,d as re}from"./card-XD_VQd1P.js";import{L as ne}from"./label-CpBi_1et.js";import{T as ie,L as ae}from"./textarea-ClrPereG.js";import{B as oe}from"./badge-A3eRMKky.js";import{S as m}from"./skeleton-Nih0iADS.js";import{P as le}from"./plus-CNNbip82.js";import{R as ce}from"./refresh-cw-DOCJFJcm.js";import{A as de}from"./arrow-right-zILYgS6B.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=q("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=q("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),ye=()=>{const[x,g]=n.useState(""),[c,f]=n.useState([]),[a,T]=n.useState(!1),[w,V]=n.useState(!1),[j,P]=n.useState(!1),[C,S]=n.useState(!0),{toast:l}=K(),H=Q(),{currentUser:L}=_(),v=n.useRef(null),O=n.useRef(null),b=n.useRef(""),h=n.useRef(""),p=n.useRef(new Set);n.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;V(!!s),s||console.warn("Web Speech API not supported in this browser.")},[]),n.useEffect(()=>{let s=!0;return L?(S(!0),D().then(t=>{if(s&&(t!=null&&t.savedIngredients)&&t.savedIngredients.length>0){const d=t.savedIngredients;g(d.join(", ")),console.log("Loaded saved ingredients:",d)}}).catch(t=>{console.error("Failed to load saved ingredients:",t)}).finally(()=>{s&&S(!1)})):S(!1),()=>{s=!1}},[L]),n.useEffect(()=>{if(!C){const s=x.trim().replace(/,\s*$/,"");if(s){const t=s.split(/[,\n]+/).map(i=>i.trim()).filter(i=>i.length>0),d=Array.from(new Map(t.map(i=>[i.toLowerCase(),i])).values());f(d)}else f([])}},[x,C]);const y=n.useCallback(()=>{v.current&&a&&(v.current.stop(),console.log("Requested speech recognition stop."))},[a]),M=n.useCallback(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s)return;const t=x.trim();b.current=t?t.replace(/,\s*$/,"")+", ":"",h.current="",p.current=new Set(t.split(/[,\n]+/).map(r=>r.trim().toLowerCase()).filter(Boolean));const d=s;v.current=new d;const i=v.current;i.continuous=!0,i.interimResults=!0,i.lang="en-US",i.onstart=()=>{T(!0),l({title:"Listening...",description:"Speak your ingredients. Say 'stop listening' or 'done' to finish."})},i.onresult=r=>{let u="",k="",E=!1;for(let N=r.resultIndex;N<r.results.length;++N){const F=r.results[N][0].transcript;if(r.results[N].isFinal){let o=F.trim();const R=o.toLowerCase(),A=/stop listening|done/gi;if(A.test(R)){o=o.replace(A,"").trim();const $=o.toLowerCase();E=!0,o&&!p.current.has($)&&(p.current.add($),k+=o+", ")}else o&&!p.current.has(R)?(p.current.add(R),k+=o+", "):o&&console.log(`Duplicate skipped: ${o}`)}else u+=F}k&&(h.current+=k);const J=b.current+h.current+u;g(J),E&&y()},i.onerror=r=>{console.error("Speech recognition error",r.error,r.message);let u=`Error: ${r.error}. Please try again.`;r.error==="no-speech"?u="No speech detected. Mic working?":r.error==="audio-capture"?u="Microphone error. Check connection/permissions.":r.error==="not-allowed"&&(u="Microphone access denied. Please allow in browser settings."),l({title:"Recognition Error",description:u,variant:"destructive"})},i.onend=()=>{T(!1);let r=(b.current+h.current).trim();r=r.replace(/,\s*$/,""),g(r),b.current="",h.current="",console.log("Speech recognition ended.")},i.start()},[x,l,y]),W=n.useCallback(()=>{if(!w){l({title:"Not Supported",description:"Speech recognition isn't available in your browser.",variant:"destructive"});return}a?y():M()},[a,w,M,y,l]),G=s=>{const t=c.filter(d=>d.toLowerCase()!==s.toLowerCase());f(t),g(t.join(", "))},X=()=>{g(""),f([]),p.current.clear()},Z=async()=>{if(c.length===0){l({title:"No Ingredients",description:"Please add at least one ingredient.",variant:"destructive"});return}if(!L){l({title:"Login Required",description:"Please log in to save ingredients and generate recipes.",variant:"destructive"});return}P(!0);try{await se({savedIngredients:c}),l({title:"Ingredients Saved",description:"Your ingredients list has been updated."}),H("/create")}catch(s){console.error("Error saving ingredients to profile:",s),l({title:"Save Error",description:"Could not save your ingredients list.",variant:"destructive"})}finally{P(!1)}};return C?e.jsxs("div",{className:"container max-w-3xl mx-auto py-12 px-4",children:[e.jsx(m,{className:"h-8 w-1/2 mx-auto mb-2"}),e.jsx(m,{className:"h-4 w-3/4 mx-auto mb-8"}),e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsx(m,{className:"h-6 w-1/3 mb-2"}),e.jsx(m,{className:"h-4 w-2/3"})]}),e.jsx(U,{children:e.jsx(m,{className:"h-24 w-full"})}),e.jsx(Y,{children:e.jsx(m,{className:"h-10 w-32 ml-auto"})})]})]}):e.jsxs("div",{className:"container max-w-3xl mx-auto py-12 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-center",children:"Ingredient Entry"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center mb-8",children:"Tell us what ingredients you have. Your list is saved to your profile."}),e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-recipe-primary dark:text-recipe-accent"}),"Enter Your Ingredients"]}),e.jsx(re,{children:"Type or speak the ingredients you have available. Separate with commas or new lines."})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsx(ne,{htmlFor:"ingredients",className:"text-lg font-semibold",children:"Your Ingredients"}),w&&e.jsx(I,{variant:a?"destructive":"outline",size:"sm",onClick:W,disabled:!w,"aria-live":"polite","aria-label":a?"Stop listening for ingredients":"Start listening for ingredients",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-pulse"}),"Stop Listening"]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add by Voice"]})})]}),e.jsx(ie,{id:"ingredients",ref:O,placeholder:"Example: Chicken breast, rice, onions, garlic, olive oil...",value:x,onChange:s=>g(s.target.value),className:"min-h-[120px] text-base focus:ring-recipe-primary dark:focus:ring-recipe-accent",disabled:a,rows:5}),c.length>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[c.length," ingredient",c.length!==1&&"s"," added:"]}),e.jsxs(I,{variant:"ghost",size:"sm",onClick:X,className:"text-gray-500 hover:text-red-600 dark:hover:text-red-400",disabled:j||a,children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((s,t)=>e.jsxs(oe,{variant:"secondary",className:"pl-3 py-1 flex items-center gap-1 text-sm bg-recipe-light dark:bg-gray-700",children:[s,e.jsx("button",{onClick:()=>G(s),className:"ml-1 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 p-0.5 focus:outline-none focus:ring-1 focus:ring-red-500","aria-label":`Remove ${s}`,disabled:j||a,children:e.jsx(ee,{className:"h-3 w-3"})})]},`${s.toLowerCase()}-${t}`))})]})]}),a&&e.jsx("div",{className:"text-center p-3 mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/30 rounded-md",children:e.jsxs("span",{className:"flex items-center justify-center text-red-600 dark:text-red-400 gap-2 font-medium",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),'Listening... Say "done" or "stop listening" when finished.']})}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 pt-2",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Tip:"}),' Be specific! "1 lb ground beef" is better than just "beef".']})})]}),e.jsx(Y,{className:"flex flex-col sm:flex-row gap-3 justify-end border-t pt-6",children:e.jsx(I,{variant:"default",size:"lg",onClick:Z,disabled:c.length===0||j||a,className:"w-full sm:w-auto bg-recipe-primary hover:bg-recipe-secondary dark:bg-recipe-accent dark:hover:bg-recipe-primary text-white dark:text-black",children:j?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving & Proceeding..."]}):e.jsxs(e.Fragment,{children:["Find Recipes With These Ingredients",e.jsx(de,{className:"ml-2 h-4 w-4"})]})})})]})]})};export{ye as default};
